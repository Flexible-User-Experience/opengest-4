{% extends sonata_block.templates.block_base %}

{% trans_default_domain "admin" %}

{% block block %}
    <div class="col-md-3">
        <div class="box box-success">
            <div class="box-header">
                <h4 class="box-title">
                    Crear partes de trabajo
                </h4>
            </div>
            <form action="{{ path('admin_app_operator_operatorworkregister_createCustomWorkRegister') }}">
                <div class="box-body">
                    <div class="form-group" id="sonata-ba-field-container-custom_date">
                        <label class="control-label required" for="custom_date">
                            Data
                        </label>
                        <div class="sonata-ba-field sonata-ba-field-standard-natural">
                            <div class="input-group">
                                <div class="input-group date" id="dp_custom_date">
                                    <input type="text"
                                           id="custom_date"
                                           name="custom_date"
                                           required="required"
                                           class="sonata-medium-date form-control"
                                           data-date-format="DD-MM-YYYY"
                                           value="{{ "now"|date("d-m-y") }}">
                                    <span class="input-group-addon">
                                        <span class="fa-calendar fa"></span>
                                    </span>
                                </div>
                            </div>
                            <script type="text/javascript">
                              jQuery(function ($) {
                                $('#dp_custom_date').datetimepicker({
                                  "pickTime": false,
                                  "pickDate": true,
                                  "useCurrent": true,
                                  "minDate": "1\/1\/1900",
                                  "maxDate": null,
                                  "showToday": true,
                                  "language": "es",
                                  "defaultDate": "",
                                  "disabledDates": [],
                                  "enabledDates": [],
                                  "icons": {
                                    "time": "fa fa-clock-o",
                                    "date": "fa fa-calendar",
                                    "up": "fa fa-chevron-up",
                                    "down": "fa fa-chevron-down"
                                  },
                                  "useStrict": false,
                                  "sideBySide": false,
                                  "daysOfWeekDisabled": [],
                                  "collapse": true,
                                  "calendarWeeks": false,
                                  "viewMode": "days",
                                  "minViewMode": "days",
                                  "useSeconds": false
                                });
                              });
                            </script>
                            <span class="help-block sonata-ba-field-widget-help sonata-ba-field-help"></span>
                        </div>
                    </div>
                    <div class="form-group" id="sonata-ba-field-container-custom_operator">
                        <label class="control-label required" for="custom_operator">
                            Operario
                        </label>
                        <div class="sonata-ba-field sonata-ba-field-standard-natural" style="width: 100%;">
                            <select class="select2-container" style="width: 100%;" name="custom_operator" id="custom_operator">
                                <option value="">---selecione un operario---</option>
                                {% for operator in content.operators %}
                                <option value="{{ operator.id }}">{{ operator }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <div class="form-group" id="sonata-ba-field-container-select_input_type">
                        <label class="control-label required" for="s60fa7bcba2582_operator">
                            Tipo
                        </label>
                        <div class="sonata-ba-field sonata-ba-field-standard-natural" style="width: 100%;">
                            <select class="select2-container" style="width: 100%;" id="select_input_type" name="select_input_type">
                                <option value="hour">Horas</option>
                                <option value="unit">Items</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group" id="sonata-ba-field-container-custom_start">
                        <label class="control-label required" for="custom_start">
                            Empieza
                        </label>
                        <div class="sonata-ba-field sonata-ba-field-standard-natural" style="width: 100%;">
                            <div class="row">
                                <div class="col-sm-6">
                                    <select class="select2-container" style="width: 100%;" name="custom_start[hour]">
                                        {% for time_picker_hour in content.time_picker_hours %}
                                            <option value="{{ time_picker_hour }}">{{ time_picker_hour }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="col-sm-6">
                                    <select class="select2-container" style="width: 100%;" name="custom_start[minute]">
                                        {% for time_picker_minute in content.time_picker_minutes %}
                                            <option value="{{ time_picker_minute }}">{{ time_picker_minute }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group" id="sonata-ba-field-container-custom_finish">
                        <label class="control-label required" for="custom_finish">
                            Termina
                        </label>
                        <div class="sonata-ba-field sonata-ba-field-standard-natural" style="width: 100%;">
                            <div class="row">
                                <div class="col-sm-6">
                                    <select class="select2-container" style="width: 100%;" name="custom_finish[hour]">
                                        {% for time_picker_hour in content.time_picker_hours %}
                                            <option value="{{ time_picker_hour }}">{{ time_picker_hour }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="col-sm-6">
                                    <select class="select2-container" style="width: 100%;" name="custom_finish[minute]">
                                        {% for time_picker_minute in content.time_picker_minutes %}
                                            <option value="{{ time_picker_minute }}">{{ time_picker_minute }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group" id="sonata-ba-field-container-description">
                        <label class="control-label" for="description">
                            Descripción
                        </label>
                        <div class="sonata-ba-field sonata-ba-field-standard-natural" style="width: 100%;">
                            <select class="select2-container" style="width: 100%;" name="custom_description">
                                <option value="">---seleccione una descripción---</option>
                                {% for id,description in content.timeDescriptions %}
                                    <option value="{{ id }}">{{ description }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <div class="form-group" id="sonata-ba-field-container-item">
                        <label class="control-label required" for="item">
                            Item
                        </label>
                        <div class="sonata-ba-field sonata-ba-field-standard-natural" style="width: 100%;">
                            <select class="select2-container" style="width: 100%;" name="custom_item" id="custom_item">
                                <option value="">---selecione un item---</option>
                                {% for id,item in content.items %}
                                    <option value="{{ id }}">{{ item }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>

                    <button class="btn btn-success" type="submit" id="btn_custom_submit" name="btn_custom_submit"><i class="fa fa-save" aria-hidden="true"></i> Crear</button>
                </div>
            </form>
        </div>
    </div>
    <div class="col-md-9">
        <div class="box box-success">
            <div class="box-header">
                <h4 class="box-title">
                    Partes de trabajo
                </h4>
            </div>
        </div>
    </div>

    <script type="text/javascript">
      jQuery(document).ready(function() {

        var selectInputType = jQuery('#select_input_type');
        var selectOperator = jQuery('#custom_operator');
        var selectItem = jQuery('#custom_item');

        var operator = jQuery('#sonata-ba-field-container-custom_operator');
        var customStart = jQuery('#sonata-ba-field-container-custom_start');
        var customFinish = jQuery('#sonata-ba-field-container-custom_finish');
        var customDescription = jQuery('#sonata-ba-field-container-description');
        var item = jQuery('#sonata-ba-field-container-item');

        var submitButton = jQuery('#btn_custom_submit');

        item.addClass('hidden');
        submitButton.addClass('disabled').attr('disabled', 'disabled');

        selectInputType.change(function (event) {
          const type = event.added.id;
          if (type === "unit") {
            customStart.addClass('hidden');
            customFinish.addClass('hidden');
            customDescription.addClass('hidden');
            item.removeClass('hidden');
          } else if (type === "hour") {
            customStart.removeClass('hidden');
            customFinish.removeClass('hidden');
            customDescription.removeClass('hidden');
            item.addClass('hidden');
          }
          enableDisableSubmitButton();
        });

        selectOperator.change(function (event) {
          enableDisableSubmitButton();
        });

        selectItem.change(function (event) {
          enableDisableSubmitButton();
        });

        function enableDisableSubmitButton() {
          if (requiredFieldsAreFilled()) {
            submitButton.removeClass('disabled').removeAttr('disabled', 'disabled');
          } else {
            submitButton.addClass('disabled').attr('disabled', 'disabled');
          }
        }

        function requiredFieldsAreFilled() {
          if (selectOperator.val() === '') {

            return false;
          }
            if (selectInputType.val() === 'unit') {
              console.log(selectItem.val(), "select item");
              if (selectItem.val() === '') {

                return false;
              }
            }

          return true;
        }

      });

    </script>

{% endblock %}
